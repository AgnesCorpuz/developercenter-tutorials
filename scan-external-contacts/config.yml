---
title: Scan through External Contacts
description: See how to scan through external contacts, external organizations, relationships and notes using the External Contacts API.
categories:
- Contacts
steps:
- title: Introduction
  content: |
    This tutorial walks through the steps of implementing a function to scan through the external contacts of a Genesys Cloud organization, and to process them before saving them into a file.

    There are 4 types of objects that can be retrieved using the External Contacts Scanning API: External Contacts, External Organizations, Relationships, and Notes.

    Go here for more information about [External Contacts Scanning](/api/rest/v2/externalcontacts/scan.html).

    For this tutorial, we are going to use the Genesys Cloud SDK, and we will scan and export the External Contacts.
    
    The sample code is using javascript async/await (making it synchronous) to ease readibility. You can change and update it based on your needs.

- title: Authentication
  content: |
    You will need an OAuth client to authenticate. See [Create an OAuth Client](https://help.mypurecloud.com/articles/create-an-oauth-client/) for more info
    
    Your OAuth client will need the following permissions (assigned through a role).
    
    To scan External Contacts, Relationships or Notes: `externalContacts:contact:view`
    
    To scan External Organizations: `externalContacts:externalOrganization:view`
    

    In this tutorial, we will use an OAuth client with Client Credentials Grant.
    
    Update this sample with your OAuth ClientID, ClientSecret, and your Genesys Cloud region.

- title: Generate an OAuth client token
  content: |
    In order to call the External Contacts Scanning endpoint you will need to use your OAuth client to generate a token. See [Grant - Client Credentials](/api/rest/authorization/use-client-credentials.html) for more info

- title: Sample Parameters
  content: |
    The sample code defines a set of parameters, specific to the sample, to make it easier to modify them and to adapt them to your needs.

    `maxRecordsPerPage`: the External Contacts Scan API endpoints allow to retrieve from 10 (min) to 200 (max) records per page. Default value is 100.

    `minAPIRequestInterval` and `minWaitTime`: the sample code forces a pause between 2 API requests. This is to make sure that if you run the script, you will not hit an API rate limit (300 requests/minute for the client token). The sample is currently configured for more or less 2 API requests/second (500ms interval).
    
    You can adapt the pause duration to your needs and current use of API in your organization.
    
    As the scan of External Contacts (for export/save) is likely not something that has to return immediately (no real-time needs), it shouldn't be a problem to make a pause, and even to execute your code via a nightly batch.

    The sample also manages a maximum number of consecutive rate limit errors (the application will exit).

    It is possible to export the External Contacts to a CSV file (and to configure the field separator) or to a raw JSON file (JSON Array of External Contacts).

- title: Login
  content: |
    The main function first obtains an OAuth Client token.

- title: Opening output file for export
  content: |
    A Stream (Write) is created to write the External Contacts to a file.

    Depending on the type of export (CSV or raw JSON), a "header" string is written to the file.

- title: Scan in loop
  content: |
    The main function will then initiate a loop, [scanning for External Contacts page per page](/api/rest/v2/externalcontacts/#get-api-v2-externalcontacts-scan-contacts), until all data is retrieved.

- title: Process and Export retrieved data
  content: |
    If a page containing External Contacts is retrieved, they are processed and written to the output file (via the Stream) according to the type of export (CSV or raw JSON).

    Note that an External Contacts Scan request can be successful while not bringing back any External Contacts (entities array attribute is empty).

    This can happen in certain exceptional conditions (database congestion, contacts from last page deleted just before requesting last page, ...)

    This does not mean that there is no more data to retrieve. End of Data (last page) is only based on not having an "after" attribute under "cursors" object.
    
- title: Continue or Finish loop
  content: |
    If the page was the last one (no cursors.after attribute - i.e. isFinished === true), the variable used to exit the loop is updated.

    Otherwise, the script performs a forced pause before making the next API request. The duration of the pause varies and is meant to impose a minimum time of minAPIRequestInterval milliseconds between 2 API requests (500 ms in this sample).

- title: Closing output file
  content: |
    Once all External Contacts are retrieved and exported to the file, depending on the type of export (CSV or raw JSON), a "footer" string is written to the file and the Stream is closed.

- title: scanContacts Function
  content: |
    The scanContacts function performs the [External Contacts Scan API request](/api/rest/v2/externalcontacts/#get-api-v2-externalcontacts-scan-contacts).

    The first time the function is called, cursor input parameter is null - so it is not added/set in the External Contacts Scan API request (request first page).

- title: Check if some data was received
  content: |
    On success, the function checks if some External Contacts have been returned (entities array attribute).

- title: Check if there is some more data to retrieve
  content: |
    The function then checks if there is more data to retrieve, or if it was the last page, based on the "after" attribute inside "cursors" (cursors.after).

- title: Manage API Rate Limit error
  content: |
    The function also manages API rate limit errors (429).
    
    This type of errors should not happen unless you modify the minAPIRequestInterval parameter to a too small value, which will cause the script to invoke API requests over the rate limit ([300 requests per token/minute](/api/rest/v2/organization/limits.html)).
    
    The function will make a pause, using the duration provided in the 429 "retry-after" header (as seconds).
    See [Best practices for retrying requests](/api/rest/rate_limits.html#best_practices_for_retrying_requests).
    
    The function will then attempt to request the same page again.

languages: 
  nodejs:
    displayName: NodeJS
    steps:
    - file: "nodejs/index.js"
      highlight: "0-298"
    - file: "nodejs/index.js"
      highlight: "5-14"
    - file: "nodejs/index.js"
      highlight: "42-59,166-172"
    - file: "nodejs/index.js"
      highlight: "16-28"
    - file: "nodejs/index.js"
      highlight: "166-172"
    - file: "nodejs/index.js"
      highlight: "177-195"
    - file: "nodejs/index.js"
      highlight: "197-267"
    - file: "nodejs/index.js"
      highlight: "207-237"
    - file: "nodejs/index.js"
      highlight: "239-260"
    - file: "nodejs/index.js"
      highlight: "269-285"
    - file: "nodejs/index.js"
      highlight: "61-88"
    - file: "nodejs/index.js"
      highlight: "90-94"
    - file: "nodejs/index.js"
      highlight: "96-101"
    - file: "nodejs/index.js"
      highlight: "111-139"
